<!DOCTYPE html>
<html>
<head>
  <title>Bakery Feedback</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    #menu-container { margin-top: 20px; }
    .menu-item {
      display: flex; /* Aligns items in a row */
      justify-content: space-between; /* Puts space between name and buttons */
      align-items: center; /* Vertically centers items */
      border: 1px solid #ccc;
      padding: 10px;
      margin-bottom: 5px;
    }
    .menu-item span { font-weight: bold; }
    .menu-item button { margin-left: 5px; font-size: 1.2em; }
  </style>
</head>
<body>

  <h1>Bakery Menu</h1>
  <div id="menu-container">
    <p>Loading menu...</p>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>

  <script>
    // =========================================================================
    // STEP 2: YOUR FIREBASE CONFIGURATION
    // This is your same config object.
    // =========================================================================
    const firebaseConfig = {
      apiKey: "AIzaSyDZkVnHXI3siPKZXvFRPMEslbeoyTPGmJM",
      authDomain: "ccidxbakery.firebaseapp.com",
      projectId: "ccidxbakery",
      storageBucket: "ccidxbakery.firebasestorage.app",
      messagingSenderId: "540177774922",
      appId: "1:540177774922:web:0db9487fb683f4edec29b3"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    
    // Get a reference to the Firestore database
    const db = firebase.firestore();

    // =========================================================================
    // STEP 3: YOUR APP'S JAVASCRIPT LOGIC
    // =========================================================================
    
    const menuContainer = document.getElementById('menu-container');

    // ** NEW FUNCTION **
    // This function will update the database when a button is clicked.
    async function updateVote(docId, fieldToUpdate) {
      
      // 1. Get a reference to the specific document (e.g., 'Sourdough Loaf')
      const docRef = db.collection('weekly-menu').doc(docId);

      // 2. Use 'FieldValue.increment(1)' to safely add 1 to the count.
      // This prevents errors if two people vote at the exact same time.
      const increment = firebase.firestore.FieldValue.increment(1);

      // 3. Update the document.
      try {
        if (fieldToUpdate === 'like') {
          await docRef.update({ likes: increment });
          console.log("Like recorded!");
        } else if (fieldToUpdate === 'dislike') {
          await docRef.update({ dislikes: increment });
          console.log("Dislike recorded!");
        }
        // Note: The page won't auto-update the like count yet. 
        // We'll add that later. A simple page refresh will show the new number.
        
      } catch (error) {
        console.error("Error updating vote:", error);
      }
    }


    // ** MODIFIED FUNCTION **
    // This function now builds the buttons as well as the text.
    async function getMenu() {
      try {
        const snapshot = await db.collection('weekly-menu').get();
        menuContainer.innerHTML = ''; 

        snapshot.forEach(doc => {
          const data = doc.data();
          
          // 1. Create the container for the item
          const itemElement = document.createElement('div');
          itemElement.classList.add('menu-item');
          
          // 2. Create the text for the item
          const itemText = document.createElement('span');
          // We only display LIKES, as requested in "Option A"
          itemText.textContent = `${data.itemName} (Likes: ${data.likes})`;
          
          // 3. Create the container for the buttons
          const buttonContainer = document.createElement('div');

          // 4. Create the "Like" button
          const likeButton = document.createElement('button');
          likeButton.textContent = 'ðŸ‘';
          // This tells the button what to do on click:
          // Call 'updateVote' with this document's ID and the action 'like'
          likeButton.onclick = () => updateVote(doc.id, 'like');

          // 5. Create the "Dislike" button
          const dislikeButton = document.createElement('button');
          dislikeButton.textContent = 'ðŸ‘Ž';
          // Call 'updateVote' with this document's ID and the action 'dislike'
          dislikeButton.onclick = () => updateVote(doc.id, 'dislike');

          // 6. Put the buttons in their container
          buttonContainer.appendChild(likeButton);
          buttonContainer.appendChild(dislikeButton);
          
          // 7. Add the text and the button container to the main item element
          itemElement.appendChild(itemText);
          itemElement.appendChild(buttonContainer);
          
          // 8. Add the whole item to the page
          menuContainer.appendChild(itemElement);
        });

      } catch (error) {
        console.error("Error fetching menu:", error);
        menuContainer.innerHTML = '<p>Error loading menu. Please try again later.</p>';
      }
    }

    // Run the function!
    getMenu();
  </script>

</body>
</html>
